<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONOE Security Operations Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bgMain: '#080c14',
                        colBg: '#111827',     // Gray 900
                        cardBg: '#1f2937',    // Gray 800
                        primary: '#0ea5e9',   // Sky 500
                        accent: '#38bdf8',    // Sky 400
                        critical: '#ef4444',  // Red 500
                        secure: '#10b981',    // Emerald 500
                        warning: '#eab308',   // Yellow 500
                        textMain: '#f0f9ff',
                        textSub: '#94a3b8'
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #080c14; color: #f0f9ff; font-family: 'Inter', sans-serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }

        /* Range Slider Styling */
        input[type=range] { -webkit-appearance: none; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #0ea5e9; margin-top: -6px; 
            box-shadow: 0 0 10px rgba(14, 165, 233, 0.6); border: 2px solid #080c14;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #374151; border-radius: 2px;
        }
        input[type=range]:focus { outline: none; }
    </style>
</head>
<body class="lg:h-screen flex flex-col overflow-x-hidden lg:overflow-hidden p-3 md:p-5">

    <header class="shrink-0 mb-4 border-b border-gray-800 pb-4">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <div class="flex items-center gap-2 mb-1">
                    <span class="bg-primary text-black text-[10px] font-bold px-2 py-0.5 rounded uppercase">Security Ops</span>
                    <span class="text-textSub text-xs uppercase tracking-widest font-bold">Interface 3</span>
                </div>
                <h1 class="text-2xl font-bold flex items-center gap-2 text-white">
                    <span>üõ°Ô∏è</span> Security Deployment Grid
                </h1>
            </div>

            <div class="w-full md:w-auto flex justify-between md:justify-start gap-0 bg-gray-900 rounded border border-gray-800 shadow-lg border-l-4 border-l-primary overflow-hidden">
                <div class="px-3 py-2 border-r border-gray-700 flex-1 md:flex-none text-center md:text-left">
                    <div class="text-[10px] text-textSub uppercase whitespace-nowrap">Total Personnel</div>
                    <div class="text-lg md:text-xl font-bold text-white"><span id="kpiReq">0</span> L</div>
                </div>
                <div class="px-3 py-2 border-r border-gray-700 flex-1 md:flex-none text-center md:text-left">
                    <div class="text-[10px] text-textSub uppercase text-primary whitespace-nowrap">Est. Cost</div>
                    <div class="text-lg md:text-xl font-bold text-accent">‚Çπ<span id="kpiCost">0</span> Cr</div>
                </div>
                <div class="px-3 py-2 flex-1 md:flex-none text-center md:text-left">
                    <div class="text-[10px] text-textSub uppercase whitespace-nowrap">Force Deficit</div>
                    <div class="text-lg md:text-xl font-bold text-critical" id="kpiDeficit">0%</div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex-grow grid grid-cols-1 lg:grid-cols-12 gap-5 min-h-0">

        <div class="lg:col-span-3 flex flex-col gap-4 h-full min-h-0">
            
            <div class="bg-colBg p-4 rounded-xl border border-gray-800 shadow-lg shrink-0">
                <h3 class="font-bold text-xs mb-4 flex items-center gap-2 text-primary uppercase tracking-wide">
                    <span>‚ö°</span> Command Parameters
                </h3>

                <div class="mb-5">
                    <div class="flex justify-between text-xs mb-2">
                        <span class="text-gray-300">Security Level</span>
                        <span class="font-mono font-bold" id="valThreat">Normal</span>
                    </div>
                    <input type="range" id="sliderThreat" min="1" max="3" value="1.5" step="0.5" oninput="updateSim()">
                </div>

                <div class="mb-5">
                    <div class="flex justify-between text-xs mb-2">
                        <span class="text-gray-300">Central Force (CAPF)</span>
                        <span class="font-mono font-bold text-accent" id="valCapf">30%</span>
                    </div>
                    <input type="range" id="sliderCapf" min="10" max="80" value="30" step="10" oninput="updateSim()">
                </div>

                <div class="mb-1">
                    <div class="flex justify-between text-xs mb-2">
                        <span class="text-gray-300">Tech Surveillance</span>
                        <span class="font-mono font-bold text-secure" id="valTech">0%</span>
                    </div>
                    <input type="range" id="sliderTech" min="0" max="40" value="0" step="10" oninput="updateSim()">
                </div>
            </div>

            <div class="bg-colBg p-4 rounded-xl border border-gray-800 shadow-lg flex-grow flex flex-col min-h-[250px]">
                <h3 class="text-xs font-bold text-textSub uppercase mb-2">Force Availability</h3>
                <div class="relative w-full flex-grow min-h-[150px]">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
        </div>

        <div class="lg:col-span-6 bg-colBg rounded-xl border border-gray-800 shadow-lg flex flex-col h-[500px] lg:h-auto overflow-hidden">
            <div class="p-4 border-b border-gray-800 bg-gray-900/50 flex justify-between items-center shrink-0">
                <h3 class="font-bold text-white text-sm">Tactical Zone Matrix</h3>
                <div class="flex gap-3 text-[10px]">
                    <span class="flex items-center gap-1"><div class="w-2 h-2 bg-emerald-500 rounded-full"></div> OK</span>
                    <span class="flex items-center gap-1"><div class="w-2 h-2 bg-yellow-500 rounded-full"></div> Strain</span>
                    <span class="flex items-center gap-1"><div class="w-2 h-2 bg-red-500 rounded-full"></div> Deficit</span>
                </div>
            </div>
            
            <div class="flex-grow overflow-y-auto p-4 custom-scrollbar">
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="matrixGrid">
                    </div>
            </div>
        </div>

        <div class="lg:col-span-3 flex flex-col gap-4 h-full min-h-0">
            <div class="bg-colBg p-4 rounded-xl border border-gray-800 shadow-lg flex-grow flex flex-col min-h-[250px]">
                <h3 class="text-xs font-bold text-textSub uppercase mb-4">Cost Projection Curve</h3>
                <div class="w-full flex-grow relative min-h-[150px]">
                    <canvas id="scatterChart"></canvas>
                </div>
                <div class="mt-3 text-[10px] text-gray-500 text-center leading-tight">
                    Cost increases exponentially with threat level elevation.
                </div>
            </div>

            <div class="bg-cardBg p-5 rounded-xl border border-gray-700 shadow-lg shrink-0">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-xs text-gray-400">Total CAPF Companies</span>
                    <span class="text-2xl font-bold text-white" id="valCompanies">0</span>
                </div>
                <button onclick="downloadCSV()" class="w-full bg-primary hover:bg-sky-400 text-black py-3 rounded-lg font-bold text-xs uppercase transition shadow-lg shadow-sky-900/20 flex justify-center items-center gap-2">
                    <span>üì°</span> Export Data
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- DATASET ---
        const rawCsvData = `State,Booths_k,State_Police_k,Sensitive_Booths_Pct
Uttar Pradesh,160,250,35
Maharashtra,95,200,20
West Bengal,78,90,45
Bihar,72,80,40
Tamil Nadu,68,110,15
Madhya Pradesh,65,100,25
Karnataka,58,95,15
Rajasthan,52,85,20
Gujarat,51,90,10
Andhra Pradesh,46,60,30
Odisha,38,55,35
Kerala,25,50,40
Telangana,35,55,20
Assam,28,45,50
Punjab,24,80,15
Haryana,19,45,25
Chhattisgarh,23,40,60
Jharkhand,29,40,55
Jammu & Kashmir,11,60,80
Delhi,13,80,5`;

        let data = [];
        let barChart, scatterChart;
        let currentSimData = [];

        function init() {
            const results = Papa.parse(rawCsvData, { header: true, dynamicTyping: true, skipEmptyLines: true });
            data = results.data;
            setupCharts();
            updateSim();
        }

        function calculateScenario() {
            const threatVal = parseFloat(document.getElementById('sliderThreat').value);
            const capfRatio = parseInt(document.getElementById('sliderCapf').value) / 100;
            const techSave = parseInt(document.getElementById('sliderTech').value) / 100;

            // UI Label Updates
            let threatLabel = "Normal";
            let threatColor = "text-white";
            if(threatVal <= 1) { threatLabel = "Low"; threatColor = "text-secure"; }
            else if(threatVal >= 2.5) { threatLabel = "Critical"; threatColor = "text-critical"; }
            else if(threatVal >= 2) { threatLabel = "High"; threatColor = "text-warning"; }
            
            const threatEl = document.getElementById('valThreat');
            threatEl.innerText = threatLabel;
            threatEl.className = `font-mono font-bold ${threatColor}`;
            
            document.getElementById('valCapf').innerText = (capfRatio*100) + "%";
            document.getElementById('valTech').innerText = (techSave*100) + "%";

            // Constants
            const BASE_PER_BOOTH = 3;
            const COST_CAPF_PER_HEAD = 0.05; 
            const COST_STATE_PER_HEAD = 0.02;

            let totalReq = 0, totalCost = 0, totalDeficit = 0, totalCompanies = 0;

            const simData = data.map(row => {
                const avgPersonnelPerBooth = (BASE_PER_BOOTH * threatVal) * (1 - techSave);
                const weightedReq = (row.Booths_k * 1000) * avgPersonnelPerBooth * (1 + (row.Sensitive_Booths_Pct/100));
                
                const reqCAPF = weightedReq * capfRatio;
                const reqState = weightedReq * (1 - capfRatio);
                
                const cost = (reqCAPF * COST_CAPF_PER_HEAD) + (reqState * COST_STATE_PER_HEAD);
                
                // Deficit calculation
                const availState = row.State_Police_k * 1000;
                const stateDeficit = Math.max(0, reqState - availState);
                
                const companies = reqCAPF / 100;

                totalReq += weightedReq;
                totalCost += cost;
                totalDeficit += stateDeficit;
                totalCompanies += companies;

                let status = 'secure';
                if(stateDeficit > 0) status = 'stretched';
                if(stateDeficit > (availState * 0.2)) status = 'deficit';

                return { ...row, req: weightedReq, costCr: cost/100, deficit: stateDeficit, status, companies };
            });

            return { totalReq, totalCost, totalDeficit, totalCompanies, simData };
        }

        function updateSim() {
            const { totalReq, totalCost, totalDeficit, totalCompanies, simData } = calculateScenario();
            currentSimData = simData;

            document.getElementById('kpiReq').innerText = (totalReq / 100000).toFixed(2);
            document.getElementById('kpiCost').innerText = (totalCost / 100).toFixed(0);
            document.getElementById('kpiDeficit').innerText = ((totalDeficit / totalReq)*100).toFixed(1) + "%";
            document.getElementById('valCompanies').innerText = Math.round(totalCompanies);

            renderMatrix(simData);
            updateCharts(totalReq, totalDeficit, totalCost);
        }

        function renderMatrix(data) {
            const grid = document.getElementById('matrixGrid');
            grid.innerHTML = '';
            
            data.forEach(d => {
                let colorClass = 'border-emerald-500/30 bg-emerald-900/10 hover:bg-emerald-900/20';
                let dotColor = 'bg-emerald-500';
                
                if(d.status === 'stretched') {
                    colorClass = 'border-yellow-500/30 bg-yellow-900/10 hover:bg-yellow-900/20';
                    dotColor = 'bg-yellow-500';
                }
                if(d.status === 'deficit') {
                    colorClass = 'border-red-500/30 bg-red-900/10 hover:bg-red-900/20';
                    dotColor = 'bg-red-500 animate-pulse';
                }

                const div = document.createElement('div');
                div.className = `p-3 rounded border ${colorClass} flex flex-col justify-between h-[85px] transition cursor-pointer group`;
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <span class="font-bold text-xs text-gray-200 truncate pr-2">${d.State}</span>
                        <div class="w-2 h-2 rounded-full shrink-0 ${dotColor} mt-1"></div>
                    </div>
                    <div>
                        <div class="flex justify-between items-end">
                            <div>
                                <div class="text-[9px] text-gray-500 uppercase tracking-wider">Req Force</div>
                                <div class="font-mono text-sm font-bold text-white">${(d.req/1000).toFixed(1)}k</div>
                            </div>
                            <div class="text-[9px] ${d.deficit > 0 ? 'text-critical' : 'text-gray-600'}">
                                ${d.deficit > 0 ? '-' + (d.deficit/1000).toFixed(1) + 'k' : 'OK'}
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(div);
            });
        }

        function setupCharts() {
            Chart.defaults.color = '#64748b';
            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.font.size = 10;
            Chart.defaults.borderColor = '#1f2937';

            // BAR CHART
            barChart = new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: ['Required', 'Available', 'Gap'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#0ea5e9', '#10b981', '#ef4444'],
                        borderRadius: 4,
                        barThickness: 20
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { 
                        x: { grid: { color: '#374151', drawBorder: false }, ticks: { display: true } },
                        y: { grid: { display: false } }
                    }
                }
            });

            // SCATTER/LINE CHART
            scatterChart = new Chart(document.getElementById('scatterChart'), {
                type: 'line',
                data: {
                    labels: ['Low', 'Normal', 'High', 'Critical'],
                    datasets: [{
                        label: 'Projected Cost',
                        data: [0, 0, 0, 0],
                        borderColor: '#38bdf8',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: (context) => {
                            const ctx = context.chart.ctx;
                            const gradient = ctx.createLinearGradient(0, 0, 0, 200);
                            gradient.addColorStop(0, 'rgba(14, 165, 233, 0.4)');
                            gradient.addColorStop(1, 'rgba(14, 165, 233, 0)');
                            return gradient;
                        },
                        pointBackgroundColor: '#0ea5e9',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: true } },
                    scales: { 
                        y: { display: true, grid: { color: '#374151', drawBorder: false } }, 
                        x: { grid: { display: false } } 
                    }
                }
            });
        }

        function updateCharts(totalReq, totalDeficit, totalCost) {
            // Bar Update
            const reqL = totalReq / 100000;
            const defL = totalDeficit / 100000;
            const availL = reqL - defL;
            
            barChart.data.datasets[0].data = [reqL, availL, defL];
            barChart.update();

            // Scatter Update - Dynamic scaling
            const baseC = totalCost / 100; 
            scatterChart.data.datasets[0].data = [
                baseC * 0.65, 
                baseC, 
                baseC * 1.8, 
                baseC * 3.2
            ];
            scatterChart.update();
        }

        function downloadCSV() {
            let csv = "State,Required_Force,Cost_Cr,Deficit_Gap,Status\n";
            currentSimData.forEach(d => {
                csv += `${d.State},${d.req.toFixed(0)},${d.costCr.toFixed(2)},${d.deficit.toFixed(0)},${d.status}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'security_deployment_plan.csv';
            a.click();
        }

        init();
    </script>
</body>
</html>