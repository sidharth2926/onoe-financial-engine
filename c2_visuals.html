<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONOE Manpower & Training Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bgMain: '#0f172a',    // Slate 900
                        colBg: '#1e293b',     // Slate 800
                        cardBg: '#334155',    // Slate 700
                        primary: '#f59e0b',   // Amber 500 (Focus on People/Gold)
                        primaryDim: 'rgba(245, 158, 11, 0.2)',
                        accent: '#fbbf24',    // Amber 400
                        success: '#10b981',   
                        danger: '#ef4444',     
                        textMain: '#f8fafc',
                        textSub: '#94a3b8'
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: 'Inter', sans-serif; }
        
        /* Custom Sliders */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #f59e0b; margin-top: -6px; cursor: pointer;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #334155; border-radius: 2px;
        }

        /* Custom Scrollbar */
        .scroller { overflow-y: auto; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden p-3 md:p-5">

    <header class="shrink-0 mb-4 border-b border-slate-800 pb-4">
        <div class="flex justify-between items-center">
            <div>
                <div class="flex items-center gap-2 mb-1">
                    <span class="bg-primary text-slate-900 text-[10px] font-bold px-2 py-0.5 rounded uppercase">HR & Training</span>
                    <span class="text-textSub text-xs uppercase tracking-widest font-bold">Interface 2</span>
                </div>
                <h1 class="text-2xl font-bold flex items-center gap-2">
                    <span>üë•</span> Personnel Command Center
                </h1>
            </div>

            <div class="flex gap-6 text-right">
                <div>
                    <div class="text-[10px] text-textSub uppercase">Total Staff</div>
                    <div class="text-xl font-bold text-white">~1.1 Cr</div>
                </div>
                <div class="border-r border-slate-700 mx-2"></div>
                <div>
                    <div class="text-[10px] text-textSub uppercase">Baseline Cost</div>
                    <div class="text-xl font-bold text-gray-500">‚Çπ<span id="kpiBase">0</span> Cr</div>
                </div>
                <div>
                    <div class="text-[10px] text-textSub uppercase text-primary">Projected Cost</div>
                    <div class="text-2xl font-bold text-white">‚Çπ<span id="kpiSim">0</span> Cr</div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex-grow grid grid-cols-1 lg:grid-cols-12 gap-4 min-h-0">

        <div class="lg:col-span-3 flex flex-col gap-4 overflow-y-auto">
            
            <div class="bg-colBg p-5 rounded-xl border border-slate-700 shadow-lg">
                <h3 class="font-bold text-sm mb-6 flex items-center gap-2 text-primary uppercase tracking-wide">
                    <span>‚öôÔ∏è</span> Policy Variables
                </h3>

                <div class="mb-8">
                    <div class="flex justify-between text-xs mb-2">
                        <span class="text-textSub">Honorarium Hike</span>
                        <span class="font-mono font-bold text-white" id="valHike">0%</span>
                    </div>
                    <input type="range" id="sliderHike" min="0" max="50" value="0" step="5" class="w-full" oninput="updateSim()">
                    <div class="text-[10px] text-gray-500 mt-1">Impacts payout to 1.1Cr staff.</div>
                </div>

                <div class="mb-8">
                    <div class="flex justify-between text-xs mb-2">
                        <span class="text-textSub">Digital Training Adoption</span>
                        <span class="font-mono font-bold text-success" id="valDigital">0%</span>
                    </div>
                    <input type="range" id="sliderDigital" min="0" max="80" value="0" step="10" class="w-full" oninput="updateSim()">
                    <div class="text-[10px] text-gray-500 mt-1">Moves physical sessions to online apps.</div>
                </div>

                <div class="mb-2">
                    <div class="flex justify-between text-xs mb-2">
                        <span class="text-textSub">Staff Rationalization</span>
                        <span class="font-mono font-bold text-primary" id="valStaff">0%</span>
                    </div>
                    <input type="range" id="sliderStaff" min="-10" max="20" value="0" step="1" class="w-full" oninput="updateSim()">
                    <div class="text-[10px] text-gray-500 mt-1">Reduce reserve staff buffer.</div>
                </div>
            </div>

            <div class="bg-colBg p-4 rounded-xl border-l-4 border-primary shadow-lg flex-grow flex flex-col justify-center">
                <div class="text-textSub text-[10px] uppercase font-bold mb-4 text-center">Cost Composition</div>
                <div class="w-48 h-48 mx-auto relative">
                    <canvas id="doughnutChart"></canvas>
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <span class="text-xs text-gray-500 font-bold">Budget<br>Split</span>
                    </div>
                </div>
            </div>

        </div>

        <div class="lg:col-span-6 flex flex-col gap-4 min-h-0">
            
            <div class="bg-colBg p-4 rounded-xl border border-slate-700 shadow-lg flex-grow min-h-0 relative flex flex-col">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-xs text-textSub uppercase">State-wise Impact Analysis</h3>
                    <div id="savingsBadge" class="text-xs font-bold px-2 py-1 rounded bg-slate-700 text-gray-300">
                        Net Impact: 0%
                    </div>
                </div>
                <div class="w-full flex-grow relative">
                    <canvas id="barChart"></canvas>
                </div>
            </div>

            <div class="bg-cardBg p-4 rounded-xl border border-slate-600 shadow-lg shrink-0 flex justify-between items-center">
                <div class="flex flex-col">
                    <span class="text-xs text-gray-400">Projected Savings via Digital Training</span>
                    <span class="text-xl font-bold text-success">‚Çπ<span id="txtDigitalSavings">0</span> Cr</span>
                </div>
                <button onclick="downloadCSV()" class="bg-primary hover:bg-amber-600 text-slate-900 px-6 py-2 rounded-lg font-bold text-sm transition shadow-lg flex items-center gap-2">
                    <span>‚¨á</span> Download HR Report
                </button>
            </div>
        </div>

        <div class="lg:col-span-3 bg-colBg rounded-xl border border-slate-700 shadow-lg flex flex-col overflow-hidden h-full">
            <div class="p-3 border-b border-slate-700 bg-slate-800/80 shrink-0">
                <h3 class="font-bold text-white text-sm">Deployment Cost Intensity</h3>
                <p class="text-[10px] text-gray-500">Sorted by cost per official</p>
            </div>
            <div class="scroller flex-grow p-2 space-y-2" id="stateList">
                </div>
        </div>

    </div>

    <script>
        // --- DATASET: MANPOWER & TRAINING ---
        // Simulated Data based on ONOE Reports
        const rawCsvData = `State,Total_Personnel_Lakhs,Base_Honorarium_Cr,Base_Training_Cost_Cr
Uttar Pradesh,12.5,450.0,220.0
Maharashtra,9.8,380.0,190.0
West Bengal,8.2,320.0,160.0
Bihar,7.9,290.0,145.0
Tamil Nadu,7.1,280.0,140.0
Madhya Pradesh,6.8,260.0,130.0
Karnataka,6.5,250.0,125.0
Rajasthan,6.2,230.0,115.0
Gujarat,5.9,220.0,110.0
Andhra Pradesh,5.4,210.0,105.0
Odisha,4.8,180.0,90.0
Kerala,4.2,160.0,80.0
Telangana,4.1,155.0,78.0
Assam,3.8,140.0,70.0
Punjab,3.5,130.0,65.0
Haryana,2.9,110.0,55.0
Chhattisgarh,2.8,105.0,52.0
Jharkhand,2.7,100.0,50.0
Uttarakhand,1.8,70.0,35.0
Himachal Pradesh,1.6,60.0,30.0`;

        let data = [];
        let barChart, doughnutChart;
        let currentSimData = [];

        function init() {
            const results = Papa.parse(rawCsvData, { header: true, dynamicTyping: true, skipEmptyLines: true });
            data = results.data;
            setupCharts();
            updateSim();
        }

        // --- CALCULATION ENGINE ---
        function calculateScenario() {
            const hike = parseInt(document.getElementById('sliderHike').value) / 100;
            const digital = parseInt(document.getElementById('sliderDigital').value) / 100; // Reduces Training Cost
            const rationalize = parseInt(document.getElementById('sliderStaff').value) / 100; // Reduces Total Count

            // Update UI Labels
            document.getElementById('valHike').innerText = (hike > 0 ? "+" : "") + (hike*100) + "%";
            document.getElementById('valDigital').innerText = (digital*100) + "%";
            document.getElementById('valStaff').innerText = (rationalize > 0 ? "-" : "") + (rationalize*100) + "%";
            
            // Color Logic for labels
            document.getElementById('valHike').className = hike > 0 ? "font-mono font-bold text-danger" : "font-mono font-bold text-white";
            document.getElementById('valStaff').className = rationalize > 0 ? "font-mono font-bold text-success" : "font-mono font-bold text-white";

            let totalBase = 0;
            let totalSim = 0;
            let totalDigitalSavings = 0;
            let totalHon = 0;
            let totalTrain = 0;

            const simData = data.map(row => {
                const baseTotal = row.Base_Honorarium_Cr + row.Base_Training_Cost_Cr;
                
                // 1. Staff Rationalization affects BOTH Honorarium and Training proportionately
                const staffFactor = 1 - rationalize;
                
                // 2. Honorarium Calc: Base * StaffFactor * (1 + Hike)
                const simHon = row.Base_Honorarium_Cr * staffFactor * (1 + hike);
                
                // 3. Training Calc: Base * StaffFactor * (1 - DigitalSavings)
                // Digital training is cheaper. 
                const simTrain = row.Base_Training_Cost_Cr * staffFactor * (1 - (digital * 0.6)); // Assuming digital is 60% cheaper for the portion applied
                
                const simTotal = simHon + simTrain;

                totalBase += baseTotal;
                totalSim += simTotal;
                
                // Track breakdown for doughnut
                totalHon += simHon;
                totalTrain += simTrain;

                // Track savings specifically from digital
                const trainWithoutDigital = row.Base_Training_Cost_Cr * staffFactor;
                totalDigitalSavings += (trainWithoutDigital - simTrain);

                return {
                    state: row.State,
                    base: baseTotal,
                    sim: simTotal,
                    personnel: row.Total_Personnel_Lakhs * staffFactor,
                    costPerCapita: (simTotal * 10000000) / (row.Total_Personnel_Lakhs * staffFactor * 100000) // Rough Cr to Lakhs conversion
                };
            });

            return { totalBase, totalSim, simData, totalHon, totalTrain, totalDigitalSavings };
        }

        // --- UPDATE UI ---
        function updateSim() {
            const { totalBase, totalSim, simData, totalHon, totalTrain, totalDigitalSavings } = calculateScenario();
            currentSimData = simData;

            // Header KPIs
            document.getElementById('kpiBase').innerText = totalBase.toLocaleString(undefined, {maximumFractionDigits:0});
            document.getElementById('kpiSim').innerText = totalSim.toLocaleString(undefined, {maximumFractionDigits:0});
            
            // Action Bar KPI
            document.getElementById('txtDigitalSavings').innerText = totalDigitalSavings.toFixed(1);

            // Badge
            const diff = totalSim - totalBase;
            const diffPct = (diff / totalBase) * 100;
            const badge = document.getElementById('savingsBadge');
            badge.innerText = `Net Impact: ${diff > 0 ? '+' : ''}${diffPct.toFixed(1)}%`;
            badge.className = diff > 0 
                ? "text-xs font-bold px-2 py-1 rounded bg-red-900 text-red-200" 
                : "text-xs font-bold px-2 py-1 rounded bg-emerald-900 text-emerald-200";

            // Update List
            renderList(simData);

            // Update Charts
            updateCharts(simData, totalHon, totalTrain);
        }

        function renderList(data) {
            const container = document.getElementById('stateList');
            container.innerHTML = '';
            
            // Sort by Cost Per Capita (Efficiency)
            const sorted = [...data].sort((a,b) => b.costPerCapita - a.costPerCapita);

            sorted.forEach(row => {
                const isHigh = row.sim > row.base;
                const arrow = isHigh ? "‚ñ≤" : "‚ñº";
                const color = isHigh ? "text-red-400" : "text-emerald-400";

                const div = document.createElement('div');
                div.className = "bg-cardBg p-2 rounded border border-slate-600 flex justify-between items-center group hover:bg-slate-600 transition";
                div.innerHTML = `
                    <div>
                        <div class="font-bold text-xs text-white">${row.state}</div>
                        <div class="text-[10px] text-textSub">${row.personnel.toFixed(2)}L Staff</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-xs text-white">‚Çπ${row.sim.toFixed(1)} Cr</div>
                        <div class="text-[10px] ${color}">${arrow} ‚Çπ${row.costPerCapita.toFixed(0)}/head</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- CHARTS ---
        function setupCharts() {
            Chart.defaults.color = '#94a3b8';
            Chart.defaults.borderColor = '#334155';
            Chart.defaults.font.family = 'Inter';

            // 1. Doughnut (Cost Split)
            doughnutChart = new Chart(document.getElementById('doughnutChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Honorarium', 'Training'],
                    datasets: [{
                        data: [50, 50],
                        backgroundColor: ['#f59e0b', '#3b82f6'], // Amber, Blue
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { legend: { display: false } }
                }
            });

            // 2. Bar (Comparison)
            barChart = new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        { label: 'Baseline', data: [], backgroundColor: '#475569', borderRadius: 4, barPercentage: 0.6 },
                        { label: 'Projected', data: [], backgroundColor: '#f59e0b', borderRadius: 4, barPercentage: 0.6 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        x: { grid: { display: false } },
                        y: { grid: { color: '#334155' }, ticks: { callback: v => '‚Çπ'+v } }
                    }
                }
            });
        }

        function updateCharts(simData, totalHon, totalTrain) {
            // Doughnut
            doughnutChart.data.datasets[0].data = [totalHon, totalTrain];
            doughnutChart.update();

            // Bar (Top 10 States by Cost)
            const top10 = [...simData].sort((a,b) => b.base - a.base).slice(0, 10);
            
            barChart.data.labels = top10.map(d => d.state);
            barChart.data.datasets[0].data = top10.map(d => d.base);
            barChart.data.datasets[1].data = top10.map(d => d.sim);
            
            // Dynamic color for Bar if saving vs loss
            const isOverallLoss = top10.reduce((a,b)=>a+b.sim,0) > top10.reduce((a,b)=>a+b.base,0);
            barChart.data.datasets[1].backgroundColor = isOverallLoss ? '#ef4444' : '#10b981'; // Red vs Green
            
            barChart.update();
        }

        function downloadCSV() {
            let csv = "State,Personnel_Lakhs,Original_Cost_Cr,Projected_Cost_Cr,Variance\n";
            currentSimData.forEach(row => {
                csv += `${row.state},${row.personnel.toFixed(2)},${row.base.toFixed(2)},${row.sim.toFixed(2)},${(row.sim-row.base).toFixed(2)}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'hr_training_simulation.csv';
            a.click();
        }

        init();
    </script>
</body>
</html>